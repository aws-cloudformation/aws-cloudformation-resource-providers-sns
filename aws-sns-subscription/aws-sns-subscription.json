{
    "typeName": "AWS::SNS::Subscription",
    "description": "An example resource schema demonstrating some basic constructs and validation rules.",
    "sourceUrl": "https://github.com/aws-cloudformation/aws-cloudformation-rpdk.git",
    "definitions": {
        "DeliveryPolicy": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "minDelayTarget": {
                    "type": "number",
                    "default": 20
                },
                "maxDelayTarget": {
                    "type": "number",
                    "default": 20
                },
                "numRetries": {
                    "type": "number",
                    "default": 3
                },
                "numNoDelayRetries": {
                    "type": "number",
                    "default": 0
                },
                "numMinDelayRetries": {
                    "type": "number",
                    "default": 0
                },
                "numMaxDelayRetries": {
                    "type": "number",
                    "default": 0
                },
                "backoffFunction": {
                    "type": "string",
                    "default": "linear"
                },
                "maxReceivesPerSecond": {
                    "type": "number",
                    "default": 0
                }
            }
        },
        "RedrivePolicy": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "deadLetterTargetArn": {
                    "type": "string"
                },
                "maxReceiveCount": {
                    "type": "string"
                }
            }
        }
    },
    "properties": {
        "Id": {
            "type": "string"
        },
        "DeliveryPolicy": {
            "description": "The delivery policy JSON assigned to the subscription. Enables the subscriber to define the message delivery retry strategy in the case of an HTTP/S endpoint subscribed to the topic.",
            "type": "object",
            "$ref": "#/definitions/DeliveryPolicy"
        },
        "Endpoint": {
            "description": "The subscription's endpoint. The endpoint value depends on the protocol that you specify.",
            "type": "string"
        },
        "Protocol": {
            "description": "The subscription's protocol. For more information, see the Protocol parameter of the Subscribe action in the Amazon Simple Notification Service API Reference.",
            "type": "string",
            "examples": ["http","https","email","email-json","sms","sqs","Endpoint Arn for mobile app and device","lambda"]
        },
        "RawMessageDelivery": {
            "description": "When set to true, enables raw message delivery. Raw messages don't contain any JSON formatting and can be sent to Amazon SQS and HTTP/S endpoints.",
            "type": "boolean"
        },
        "Region": {
            "description": "For cross-region subscriptions, the region in which the topic resides. If no region is specified, CloudFormation uses the region of the caller as the default.",
            "type": "string"
        },
        "TopicArn": {
            "description": "The ARN of the topic to subscribe to.",
            "type": "string"
        },
        "FilterPolicy": {
            "description": "The filter policy JSON assigned to the subscription. Enables the subscriber to filter out unwanted messages.",
            "type": "object"
        },
        "RedrivePolicy": {
            "description": "When specified, sends undeliverable messages to the specified Amazon SQS dead-letter queue. Messages that can't be delivered due to client errors (for example, when the subscribed endpoint is unreachable) or server errors (for example, when the service that powers the subscribed endpoint becomes unavailable) are held in the dead-letter queue for further analysis or reprocessing.",
            "type": "object",
            "$ref": "#/definitions/RedrivePolicy"
        }
    },
    "additionalProperties": false,
    "required": [
        "Endpoint",
        "Protocol",
        "TopicArn"
    ],
    "createOnlyProperties": [
        "/properties/Endpoint",
        "/properties/Protocol",
        "/properties/TopicArn"
    ],
    "primaryIdentifier": [
        "/properties/Id"
    ],
    "readOnlyProperties": [
        "/properties/Id"
    ],
    "handlers": {
        "create": {
            "permissions": [
                "sns:Subscribe"
            ]
        },
        "read": {
            "permissions": [
                "sns:GetSubscriptionAttributes",
                "sns:ListSubscriptionsByTopic",
                "sns:ListSubscriptions"
            ]
        },
        "update": {
            "permissions": [
                "sns:GetSubscriptionAttributes",
                "sns:SetSubscriptionAttributes"
            ]
        },
        "delete": {
            "permissions": [
                "sns:ListSubscriptionsByTopic",
                "sns:ListSubscriptions",
                "sns:Unsubscribe"
            ]
        },
        "list": {
            "permissions": [
                "sns:ListSubscriptions",
                "sns:ListSubscriptionsByTopic"
            ]
        }
    }
}
